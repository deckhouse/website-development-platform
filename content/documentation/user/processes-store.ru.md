---
title: Хранилище (store) для действий в BPMN — руководство
menuTitle: Store (BPMN)
d8Edition: ee
moduleStatus: experimental
---

В этом разделе описано, как пользоваться **хранилищем (store)** в процессах BPMN: как ответы задач сохраняются под слагом и как последующие задачи могут обращаться к ним в конфигурации действия через плейсхолдеры.

## 1. Что такое хранилище (store)?

Хранилище — это ключ–значение **для каждого экземпляра процесса**. В нём хранятся **ответы** завершённых задач, каждый под ключом, равным **слагу** элемента задачи. В хранилище записывается только **ответ действия** (объект, возвращаемый действием); тело запроса не сохраняется.

- **Одно хранилище на экземпляр процесса:** у каждого запуска процесса своё хранилище. Другой экземпляр того же процесса имеет другое хранилище.
- **Ключ = слаг задачи:** при успешном завершении задачи ответ действия сохраняется под слагом этого элемента задачи.
- **Чтение через плейсхолдеры:** в конфигурации действия (URL, заголовки, тело запроса и т.д.) можно использовать плейсхолдеры в стиле Go-шаблонов для чтения из хранилища.

## 2. Как это работает

### 2.1. Слаг элемента задачи

У каждого элемента задачи в процессе есть **слаг** (например, `create-project`, `deploy-step`). Слаг должен быть уникален в рамках процесса и используется как ключ в хранилище для ответа этой задачи.

### 2.2. Запись в хранилище

Когда задача успешно завершается, движок сохраняет **ответ** действия в хранилище экземпляра под слагом задачи. Отдельное поле «ключ хранилища» не используется; ключом является слаг. Если используется **временный ответ**, он не попадает в хранилище.

### 2.3. Чтение из хранилища

При подготовке действия (например, перед запуском) текущее хранилище передаётся в контексте процесса. Любое строковое поле в конфигурации действия, поддерживающее плейсхолдеры, может использовать плейсхолдеры хранилища. Отсутствующие слаги или поля подставляются как **пустая строка** и **не** приводят к ошибке действия.

## 3. Как использовать

### 3.1. Задать слаг у элементов задачи

В редакторе процесса для каждой задачи, результат которой должен быть доступен последующим шагам:

- Заполните поле **Слаг** (например, `create-project`, `fetch-order`, `deploy-step`).
- Правила слага: обязателен для задач, на которые нужно ссылаться из хранилища; обычно 3–64 символа; рекомендуется формат вроде `lowercase-with-hyphens`.

Слаги должны быть уникальны среди элементов задач в одном процессе.

### 3.2. Ссылка на хранилище в конфигурации действия

В любом **последующем** действии (в том же экземпляре процесса) используйте плейсхолдеры Go-шаблонов:

- **Синтаксис:** `{{ .store.<slug>.<field> }}`
- **Вложенные поля:** `{{ .store.<slug>.<field>.<nested> }}`

`<slug>` — слаг элемента задачи; `<field>` (и при необходимости `<nested>`) — ключи из ответа действия этой задачи.

#### Примеры

- Использовать ID из задачи «создать проект» в следующем запросе:

```yaml
url: "https://api.example.com/projects/{{ .store.create-project.id }}/deploy"
```

- Использовать несколько записей хранилища в одном действии:

```yaml
headers:
  X-Project-Id: "{{ .store.create-project.id }}"
  X-Job-Id: "{{ .store.deploy-step.jobId }}"
body: |
  {"ref": "{{ .store.previous-step.ref }}"}
```

- Вложенное поле (если ответ — объект с вложенными данными):

```yaml
projectId: "{{ .store.create-project.result.projectId }}"
```

### 3.3. Поведение при отсутствии данных

- Если **слаг** отсутствует в хранилище (например, задача ещё не выполнялась или завершилась с ошибкой), `{{ .store.<slug>.<field> }}` подставляется как **пустая строка**.
- Если **поле** отсутствует в ответе по этому слагу, плейсхолдер также подставляется как **пустая строка**.
- Действие **не** завершается ошибкой из-за отсутствующих данных в хранилище; пустым будет только результат подстановки плейсхолдера.

Можно безопасно ссылаться на ключи хранилища, которых может не быть; запрос всё равно будет отправлен, с пустыми значениями там, где данных в хранилище не было.
