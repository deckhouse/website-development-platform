---
title: AI-агент
---

{{< alert level="warning" >}}
Экспериментальный функционал
{{< /alert >}}

AI-агент — это интеллектуальный помощник, встроенный в Deckhouse Development Platform. Он отвечает на вопросы о платформе, анализирует данные каталога и выполняет различные задачи с использованием инструментов MCP (Model Context Protocol).

AI-агент использует настраиваемые AI-провайдеры для обработки запросов и может работать с различными языковыми моделями, включая OpenAI GPT, Ollama и любые модели, доступные через совместимый REST API.

## Настройка AI-провайдеров

### Типы провайдеров

Платформа поддерживает три типа AI-провайдеров:

1. **OpenAI** — для работы с моделями OpenAI (GPT-4, GPT-3.5 и др.).
1. **Ollama** — для работы с локальными моделями через Ollama.
1. **Custom** — для работы с любым кастомным REST API, совместимым с форматом запросов/ответов AI-агента.

### Создание провайдера OpenAI (ChatGPT)

Для настройки провайдера OpenAI выполните следующие шаги:

1. Откройте профиль пользователя и перейдите на вкладку **AI-провайдеры**.
1. Нажмите кнопку **Добавить**.
1. Заполните форму:
   - **Название**: `ChatGPT` (или любое другое удобное имя).
   - **Провайдер**: выберите `OpenAI`.
   - **Модель**: укажите название модели, например `gpt-4` или `gpt-3.5-turbo`.
   - **URL**: `https://api.openai.com/v1/chat/completions`.
   - **Метод**: `POST`.
   - **Заголовки**: добавьте заголовок авторизации:

     ```sh
     Authorization: Bearer YOUR_OPENAI_API_KEY
     ```

     где `YOUR_OPENAI_API_KEY` — ваш API ключ от OpenAI.

     > **Рекомендация**: Для безопасного хранения API ключей используйте [систему управления учетными данными AI-провайдеров](../ai-credentials/), которая позволяет хранить ключи в зашифрованном виде и использовать плейсхолдеры `{{credential:key}}` в заголовках.

1. Нажмите **Сохранить**.

### Создание провайдера Ollama

Для настройки локального провайдера Ollama:

1. Убедитесь, что Ollama запущена на вашем сервере.
1. Создайте нового провайдера:
   - **Название**: `Ollama Local`.
   - **Провайдер**: выберите `Ollama`.
   - **Модель**: укажите название модели, например `llama2` или `mistral`.
   - **URL**: `http://localhost:11434/api/generate` (или адрес вашего сервера Ollama).
   - **Метод**: `POST`.

1. Нажмите **Сохранить**.

### Создание кастомного провайдера

Для настройки кастомного REST API провайдера:

1. Создайте нового провайдера и выберите тип **Custom**.
1. Заполните основные поля (URL, метод, заголовки авторизации).
1. Нажмите **Сохранить**.

#### Поле ответа (Response Field)

Поле **Поле ответа** определяет путь к элементу JSON-ответа API, в котором содержится текст ответа модели. Этот путь используется для извлечения ответа из JSON, возвращаемого API провайдера.

**Формат указания пути:**
- Используйте точечную нотацию для доступа к вложенным полям.
- Для массивов используйте индекс, начиная с 0.
- Поле необязательно — если не указано, система попытается найти ответ автоматически.

**Примеры:**

Для OpenAI-совместимых API:

```json
choices.0.message.content
```

Это означает: взять первый элемент массива `choices`, затем поле `message`, затем поле `content`.

Для других форматов возможны значения `response.text`, `content`, `answer`.

**Как определить правильный путь:**
1. Выполните тестовый запрос к вашему API.
1. Изучите структуру JSON ответа.
1. Найдите поле, содержащее текст ответа модели.
1. Укажите путь к этому полю в точечной нотации.

#### Шаблон тела запроса (Request Body Template)

Поле **Шаблон тела запроса** определяет структуру JSON-запроса, который будет отправляться к API провайдера. В шаблоне можно использовать переменные, которые будут автоматически заменены на актуальные значения.

**Доступные переменные:**
- `{{.prompt}}` — текст вопроса пользователя (будет автоматически экранирован для JSON).
- `{{.model}}` — название модели, указанное в настройках провайдера.

**Примеры шаблонов:**

Для OpenAI-совместимых API:

```json
{
  "model": "{{.model}}",
  "messages": [
    {
      "role": "user",
      "content": "{{.prompt}}"
    }
  ],
  "temperature": 0.7
}
```

Для API с другим форматом:

```json
{
  "messages": [
    {
      "content": "{{.prompt}}",
      "role": "user"
    }
  ],
  "model": "{{.model}}",
  "stream": false
}
```

Для API с минимальной структурой запроса:

```json
{
  "query": "{{.prompt}}",
  "model_name": "{{.model}}"
}
```

**Важно:**
- Шаблон должен быть валидным JSON.
- Переменные `{{.prompt}}` и `{{.model}}` будут автоматически заменены при отправке запроса.
- Значение `{{.prompt}}` автоматически экранируется для безопасной вставки в JSON.
- Вы можете добавить любые дополнительные поля, необходимые для вашего API (temperature, max_tokens, и т.д.).

**Пример полной настройки кастомного провайдера:**

1. **Название**: `My Custom API`.
1. **Провайдер**: `Custom`.
1. **Модель**: `my-model-v1`.
1. **URL**: `https://api.example.com/v1/chat`.
1. **Метод**: `POST`.
1. **Заголовки**:

   ```sh
   Authorization: Bearer YOUR_API_KEY
   Content-Type: application/json
   ```

1. **Поле ответа**: `choices.0.message.content`.
1. **Шаблон тела запроса**:

   ```json
   {
     "model": "{{.model}}",
     "messages": [
       {
         "role": "user",
         "content": "{{.prompt}}"
       }
     ],
     "temperature": 0.7,
     "max_tokens": 1000
   }
   ```

## Работа с AI-агентом

### Открытие чата

AI-агент доступен через боковую панель чата в правой части интерфейса. Для открытия чата нажмите на кнопку чата в правом нижнем углу экрана или используйте горячую клавишу `/` для быстрого доступа.

### Выбор провайдера

В верхней части чата находится селектор провайдеров. Выберите нужный провайдер из списка доступных. Если у вас настроен только один провайдер, он будет выбран автоматически.

### Доступные инструменты (MCP Tools)

AI-агент использует инструменты MCP (Model Context Protocol) для работы с платформой. Полный список доступных инструментов с их описанием, параметрами и примерами использования доступен в [документации MCP-сервера](../mcp-server/).

Основные возможности инструментов:
- Получение и анализ данных из каталога платформы.
- Консультации по документации платформы.

### Просмотр доступных инструментов

В чате отображается список всех доступных инструментов с их описаниями и примерами использования. Вы можете:

- Раскрыть раздел **Доступные инструменты** для просмотра списка.
- Раскрыть каждый инструмент для просмотра его параметров и примеров.
- Кликнуть на пример, чтобы вставить его в поле ввода и сразу выполнить или отредактировать запрос.

### Формулирование вопросов

Вы можете задавать вопросы AI-агенту в свободной форме:

- **Вопросы о платформе**: «Как создать новое действие?», «Как настроить автоматизацию?».
- **Анализ данных**: «Сколько сервисов в статусе разработки?», «Покажи все сервисы с ошибками».
- **Работа с каталогом**: «Найди все сервисы, где жизненный цикл равен production».

AI-агент автоматически определит, какой инструмент использовать, и выполнит запрос.

### Особенности работы

1. **Анализ данных**: AI-агент не просто возвращает сырые данные, а анализирует их и предоставляет структурированные ответы.
1. **Фильтрация**: Вы можете запрашивать данные с условиями, и агент выполнит фильтрацию.
1, **Агрегация**: Агент может подсчитывать количество, группировать данные и предоставлять статистику.
1. **Контекст документации**: При вопросах о платформе агент использует официальную документацию.

### Отладка

Если ответ агента кажется некорректным, вы можете просмотреть логи отладки, нажав на кнопку с иконкой вопроса рядом с ответом. Это поможет понять, какие инструменты были вызваны и какие данные были получены.

## Примеры использования

### Пример 1: Анализ сервисов

**Вопрос:**

```sh
Получи все сервисы, найди те, у которых параметр 'Жизненный цикл' равен 'разработка', и выведи их количество
```

**Результат:**
Агент использует инструменты MCP для получения данных о сервисах, проанализирует их и вернет количество сервисов в разработке.

### Пример 2: Комплексный анализ

**Вопрос:**

```sh
Покажи все сервисы с ошибками и основные причины ошибок
```

**Результат:**
Агент получит данные о сервисах, проанализирует их статусы здоровья, найдет ошибки и предоставит структурированный список с причинами.

## Рекомендации

1. **Используйте конкретные вопросы**: Чем конкретнее вопрос, тем точнее будет ответ.
1. **Указывайте параметры явно**: Если вы знаете название ресурса или параметр, укажите его в вопросе.
1. **Экспериментируйте**: AI-агент понимает естественный язык, пробуйте разные формулировки вопросов.
