---
title: Учетные данные
menuTitle: Учетные данные
d8Edition: ee
moduleStatus: experimental
---

Механизм учетных данных позволяет определять, какие реквизиты будут использоваться для доступа к инфраструктурным сервисам в источниках данных, действиях и виджетах.  

Все взаимодействие с инфраструктурными сервисами в DDP происходит с использованием учетных данных конкретного пользователя.  

Понятие "системные учетные данные", то есть реквизиты, задаваемые на уровне системы в конфигурации, отсутствует в платформе, однако, если требуется использование общих учетных данных, можно создать системную учетную запись и указать для неё общие реквизиты.  

## Типы учетных данных

Типы учетных данных задаются администратором платформы в разделе `Администрирование / Учетные данные`.  

### Обязательные поля

- **Название**  
- **Идентификатор**
- **Backend для хранения** (если доступен больше чем 1)

Поле **"Описание"** является опциональным. Его содержимое будет выводиться в профиле пользователя в качестве подсказки к конкретному типу учетных данных.

### Backend для хранения

При создании или редактировании типа учетных данных можно выбрать место хранения. В данный момент доступно:

- **База данных** (по умолчанию) — учетные данные хранятся в базе данных платформы
- **Vault** — учетные данные хранятся в HashiCorp Vault

Опция выбора Vault доступна только после настройки и включения Vault.

## Хранение учетных данных в Vault

Платформа поддерживает использование HashiCorp Vault в качестве хранилища для учетных данных пользователей. Это обеспечивает дополнительный уровень безопасности.

### Настройка Vault

Перед использованием Vault необходимо настроить подключение в разделе **`Администрирование / Учетные данные`** (кнопка "Настройки Vault"):

- **URL** — адрес сервера Vault
- **Role ID** — идентификатор роли для аутентификации через AppRole
- **Secret ID** — секретный идентификатор для аутентификации через AppRole
- **Base Path** — базовый путь в KV2 хранилище (по умолчанию: `ddp`)
- **Mount Path** — путь монтирования KV2 хранилища (по умолчанию: `secret`)

Доступна функция тестирования подключения без сохранения настроек.

`Role ID` и `Secret ID` шифруются перед сохранением в базе данных платформы.

{{< alert level="warning" >}}
При отключении Vault все типы учетных данных, использующие Vault, автоматически переключаются на хранение в базе данных.  
{{< /alert >}}

### Структура хранения в Vault

Учетные данные хранятся в Vault KV2 (Key-Value версии 2) по следующему пути:

```text
{mountPath}/data/{basePath}/users/{user_uuid}/credentials/{credential_uuid}
```

Где:

- `mountPath` — путь монтирования KV2 хранилища (по умолчанию `secret`)
- `basePath` — базовый путь (по умолчанию `ddp`)
- `user_uuid` — UUID пользователя
- `credential_uuid` — UUID типа учетных данных

Каждая запись хранится как отдельный секрет в Vault.

## Учетные данные пользователя

Для каждого типа учетных данных пользователь может указать свои персональные реквизиты в разделе **`Профиль / Учетные данные`**.  

Например, если администратор создал тип учетных данных **"Kubernetes token"**, то пользователь в своем профиле сможет добавить персональный токен для доступа в Kubernetes.  

### Шифрование учетных данных

Все учетные данные шифруются перед сохранением (в базе данных или Vault) и расшифровываются непосредственно при запросе к конкретной инфраструктурной системе.

Шифрование происходит с использованием алгоритма **AES-GCM** (Advanced Encryption Standard в режиме Galois/Counter Mode). Ключ для шифрования задаётся в конфигурации DDP в поле **`security.secretKey`**.

Место хранения (база данных или Vault) определяется администратором при создании типа учетных данных.  

{{< alert level="warning" >}}
При изменении ключа шифрования в конфигурации все текущие учетные данные станут невалидными.  
{{< /alert >}}

После того как пользователь задаст свои учетные данные, он не сможет посмотреть их значение, только обновить его. Тем не менее, в профиле будет отображаться информация о том, заполнены ли те или иные учетные данные.  

Подход к использованию учетных данных в действиях, источниках данных и виджетах описан в соответствующих разделах документации.
