---
title: Учетные данные
weight: 30
---

Механизм учетных данных позволяет безопасно хранить и использовать реквизиты доступа к внешним сервисам в действиях, источниках данных, виджетах и других компонентах платформы DDP. Все учетные данные шифруются перед сохранением в базе данных и расшифровываются только при использовании.

## Принцип работы

### Типы учетных данных

Администратор платформы создает типы учетных данных в разделе **Администрирование** → **Учетные данные**. Каждый тип имеет:
- **Название** — отображаемое название типа
- **Идентификатор** — уникальный идентификатор для использования в конфигурациях
- **Описание** — подсказка для пользователей

### Учетные данные пользователей

Пользователи заполняют свои персональные учетные данные в разделе **Профиль** → **Учетные данные**. Для каждого типа учетных данных пользователь может указать свое значение (например, токен доступа, пароль, ключ API).

После сохранения пользователь не может просмотреть значение учетных данных, только обновить его. В профиле отображается информация о том, заполнены ли те или иные учетные данные.

### Хранение в базе данных

Учетные данные хранятся в базе данных PostgreSQL. Перед сохранением в базу данных значения шифруются с использованием алгоритма **AES-GCM**.

**Параметры шифрования:**
- **Алгоритм:** AES-GCM
- **Размер ключа:** 16, 24 или 32 байта (128, 192 или 256 бит)
- **Размер nonce:** 12 байт
- **Ключ шифрования:** задается в конфигурации DDP в поле `security.secretKey`

Зашифрованные значения сохраняются в базе данных с префиксом `GCM:`, что позволяет системе определить метод шифрования при расшифровке.

{{< alert level="warning" >}}
При изменении ключа шифрования (`security.secretKey`) в конфигурации все текущие учетные данные станут невалидными и не смогут быть расшифрованы.
{{< /alert >}}

### Хранение в HashiCorp Vault

В разработке находится механизм, позволяющий хранить учетные данные во внешнем хранилище, совместимом с HashiCorp Vault, вместо базы данных PostgreSQL.

### Использование учетных данных

Учетные данные расшифровываются только при необходимости их использования, непосредственно перед обращением к внешнему сервису. После использования расшифрованные значения не сохраняются в памяти дольше необходимого.

## Интеграция в компоненты платформы

### Действия

В конфигурации действия можно указать список требуемых учетных данных через поле **Учетные данные**. Каждое учетное данное определяется:
- **Идентификатор** — идентификатор учетного данного (соответствует идентификатору типа учетных данных)
- **Тип учетных данных** — выбор типа учетных данных из списка

При выполнении действия система:
1. Определяет пользователя, от имени которого выполняется действие (инициатор или учетная запись, выбранная в поле **"Учётная запись для запуска"**, если включена опция **"Выбрать учётную запись для запуска"**)
2. Извлекает учетные данные этого пользователя из базы данных
3. Расшифровывает значения учетных данных
4. Подставляет расшифрованные значения в шаблоны конфигурации действия (URL, заголовки, тело запроса) через плейсхолдеры вида `{{.credentials.идентификатор}}`

### Источники данных

В конфигурации источника данных можно указать список требуемых учетных данных аналогично действиям. При синхронизации данных система:
1. Использует учетные данные системного пользователя, указанного в конфигурации источника данных (поле **"Системная учетная запись"**)
2. Извлекает и расшифровывает учетные данные системного пользователя
3. Подставляет значения в шаблоны запросов источника данных

{{< alert level="warning" >}}
Источники данных всегда используют учетные данные системного пользователя, а не инициатора запуска синхронизации.
{{< /alert >}}

### Виджеты

Виджеты могут использовать учетные данные для получения данных из внешних сервисов. Механизм работы аналогичен действиям:
1. Определяется пользователь (инициатор запроса или учетная запись, выбранная в поле **"Учётная запись для виджета"**, если включена опция **"Выбрать учётную запись для виджета"**)
2. Извлекаются и расшифровываются учетные данные
3. Значения подставляются в конфигурацию виджета

### Проверки статуса

Проверки статуса используют учетные данные для выполнения проверок состояния сущностей. В конфигурации правил проверки статуса можно указать список требуемых учетных данных. При выполнении проверки система:
1. Использует учетные данные системного пользователя, указанного в конфигурации правила проверки статуса (поле **"Системная учетная запись"**)
2. Извлекает и расшифровывает учетные данные системного пользователя
3. Подставляет значения в шаблоны конфигурации правила (URL, заголовки, параметры запросов) через плейсхолдеры вида `{{.credentials.идентификатор}}`

{{< alert level="warning" >}}
Проверки статуса всегда используют учетные данные системного пользователя, указанного в конфигурации правила. Если системный пользователь не указан, правило пропускается при выполнении проверки.
{{< /alert >}}

### Внешние сервисы

Внешние сервисы могут иметь собственный список учетных данных. Если действие, источник данных или виджет использует внешний сервис (включена опция **"Использовать внешний сервис"**), то:
1. Учетные данные из конфигурации внешнего сервиса наследуются компонентом, если в его конфигурации не указаны собственные учетные данные
2. Приоритет имеют учетные данные, указанные непосредственно в конфигурации компонента

## Настройка

### Ключ шифрования

Ключ шифрования настраивается в конфигурации DDP в секции `security.secretKey`:

```yaml
security:
  secretKey: "your-32-byte-secret-key-here"
```

**Требования к ключу:**
- Длина: 16, 24 или 32 байта (128, 192 или 256 бит)
- Символы: только печатаемые ASCII символы
- Не должен быть слабым или часто используемым ключом
- Не должен состоять из одного повторяющегося символа

## Безопасность

- Учетные данные никогда не передаются пользователю в расшифрованном виде
- Расшифровка происходит только непосредственно перед отправкой запроса
- Расшифрованные значения не логируются
