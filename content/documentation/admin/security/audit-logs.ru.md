---
title: Аудит-логи
weight: 40
---

Аудит-логи — это механизм записи операций, выполняемых пользователями через API платформы DDP.
Логи используются для контроля действий пользователей, анализа изменений и проведения аудита.

## Компоненты

В формировании и хранении аудит-логов участвуют следующие компоненты:

- **DDP Backend** — формирует записи аудит-логов.
- **PostgreSQL** — обеспечивает хранение данных.

## Содержимое аудит-логов

Для каждого HTTP-запроса (кроме GET) создается запись аудит-лога, содержащая:

- **Email** — адрес электронной почты пользователя, выполнившего запрос.
- **IP** — IP-адрес клиента.
- **Endpoint** — путь API, к которому был выполнен запрос.
- **Method** — HTTP-метод запроса (POST, PUT, DELETE, PATCH).
- **Status** — HTTP-код ответа.
- **Body** — тело HTTP-запроса.
- **Timestamp** — время выполнения запроса.

## Принцип работы

Аудит-логи формируются автоматически в DDP Backend с использованием промежуточного слоя обработки запросов (middleware) для всех HTTP-запросов, кроме GET.

Для снижения нагрузки на базу данных используется буферизация записей со следующими параметрами:
- Размер батча — 40 записей
- Интервал записи — 20 секунд
- Размер буфера в памяти — 4 записи

## Хранение

Аудит-логи хранятся в таблице audit_logs базы данных PostgreSQL. Таблица партиционирована на основе поля `timestamp` с разделением по дням.

Структура таблицы поддерживается автоматически: ежедневно в 00:00 по серверному времени подготавливается пространство для записи логов на следующие 7 дней.

Логи хранятся неограниченно долго. Автоматическая очистка старых записей не выполняется. Для управления временем хранения необходимо настроить автоматическое удаление старых групп логов через внешние инструменты (например, cron-задачи или скрипты очистки базы данных).

## Просмотр логов

Аудит-логи доступны через веб-интерфейс в разделе **Администрирование** → **Аудит**. Логи можно фильтровать по:
- Email пользователя.
- IP адресу.
- Endpoint.
- Методу запроса.
- Статусу ответа.

## Настройка

Механизм аудит-логирования включён по умолчанию и не требует дополнительной настройки.
