---
title: Аудит-логи
weight: 70
---

Аудит-логи — это механизм записи всех операций, выполняемых пользователями через API платформы DDP. Логи сохраняются в базе данных PostgreSQL и используются для аудита действий пользователей.

## Компоненты

**Компоненты:** DDP Backend, PostgreSQL

**Функции:**
- Функция логирования операций пользователей
- Аудит действий через API
- Отслеживание изменений данных

## Что логируется

Для каждого HTTP запроса (кроме GET) создается запись аудит-лога, содержащая:

- **Email** — адрес электронной почты пользователя, выполнившего запрос
- **IP** — IP адрес клиента
- **Endpoint** — путь API endpoint
- **Method** — HTTP метод (POST, PUT, DELETE, PATCH)
- **Status** — HTTP статус код ответа
- **Body** — тело HTTP запроса
- **Timestamp** — время выполнения запроса

## Принцип работы

Аудит-логи создаются автоматически через middleware в DDP Backend для всех HTTP запросов, кроме GET.

**Параметры буферизации:**
- Размер батча: 40 записей
- Интервал записи: 20 секунд
- Размер буфера в памяти: 4 записи

Логи хранятся в партиционированной таблице PostgreSQL, разделенной по дням. Партиции создаются автоматически на 7 дней вперед. Ежедневно в 00:00 UTC запускается задача, которая создает партиции на следующие 7 дней.

## Хранение

Аудит-логи хранятся в таблице `audit_logs` в базе данных PostgreSQL. Таблица партиционирована по полю `timestamp` с разделением по дням.

**Время хранения:** Логи хранятся неограниченно долго. Автоматическая очистка старых записей не выполняется. Для управления временем хранения необходимо настроить автоматическое удаление старых партиций через внешние инструменты (например, cron задачи или скрипты очистки базы данных).

## Просмотр логов

Аудит-логи доступны через веб-интерфейс в разделе **Администрирование** → **Аудит**. Логи можно фильтровать по:
- Email пользователя
- IP адресу
- Endpoint
- Методу запроса
- Статусу ответа

## Настройка

Механизм аудит-логирования работает автоматически, дополнительная настройка не требуется. Для управления временем хранения логов необходимо настроить автоматическое удаление старых партиций базы данных.
