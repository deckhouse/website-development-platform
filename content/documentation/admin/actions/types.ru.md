---
title: Типы действий
---

## CreateDefectdojoEngagement

CreateDefectdojoEngagement — создает новый engagements в системе DefectDojo. Действие использует DefectDojo API v2. Поддерживаемые параметры соответствуют спецификации API.

### Пример запроса

```yaml
name: example engagement
product: '1'
target_start: '2024-06-01'
target_end: '2024-06-30'
lead: '1'
```

### Спецификация запроса

Список полей соответствует официальному API DefectDojo, `/api/v2/engagements`: [документация](https://demo.defectdojo.org/api/v2/oa3/swagger-ui/).

### Учетные данные

* **token** — API v2 Key пользователя, от имени которого будет запускаться выполнение действия.

## CreateDefectdojoProduct

CreateDefectdojoProduct — создает новый продукт в системе DefectDojo. Действие использует DefectDojo API v2. Поддерживаемые параметры соответствуют спецификации API.

### Пример запроса

```yaml
name: example
description: example description
prod_type: 1
```

### Спецификация запроса

Список полей соответствует официальному API DefectDojo, `/api/v2/products`: [документация](https://demo.defectdojo.org/api/v2/oa3/swagger-ui/).

### Учетные данные

* **token** — API v2 Key пользователя, от имени которого будет запускаться выполнение действия.

## CreateGitlabBranches

CreateGitlabBranches — создает новые ветки в целевом репозитории.

### Пример запроса

```yaml
project_id: '0'
branches:
  - branch: new-branch
    ref: main
```

### Спецификация запроса

| Название        | Обязательность  | Описание                                                                     |
|-----------------|-----------------|------------------------------------------------------------------------------|
| project_id      | **обязательно** | Идентификатор проекта, в котором необходимо создать ветки                    |
| branches        | **обязательно** | Список создаваемых веток                                                     |
| branches.branch | **обязательно** | Название новой ветки                                                         |
| branches.ref    | **обязательно** | Название существующей ветки или SHA-хеш коммита                              |

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects/:id/repository/branches`. В случае успешного создания проекта GitLab возвращает информацию о созданных ветках.

## CreateGitlabGroupVariables

CreateGitlabGroupVariables — создает переменные на уровне группы в GitLab.

### Пример запроса

```yaml
group_id: '0'
variables:
  - key: EXAMPLE_VARIABLE
    value: value
```

### Спецификация запроса

| Название        | Обязательность  | Описание                                                                     |
|-----------------|-----------------|------------------------------------------------------------------------------|
| group_id        | **обязательно** | Идентификатор группы, в котором необходимо создать переменные                |
| variables       | **обязательно** | Список создаваемых переменных                                                |

Список полей для variables соответствует официальному GitLab Group-level Variables API, `/groups/:id/variables`: [документация](https://docs.gitlab.com/api/group_level_variables/#create-variable).

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/groups/:id/variables`.

## CreateGitlabMergeRequest

CreateGitlabMergeRequest - создает новый merge request в целевой репозиторий. В данный merge request добавляются файлы, хранящиеся в репозитории источнике. Файлы могут содержать переменные, значение которых будет подставлено в момент создания MR.

### Пример запроса

```yaml
source_project_id: '0'
source_project_branch: example
source_project_tag: v1.0.0
target_project_id: '0'
merge_request_spec:
  source_branch: example
  target_branch: '1'
  title: example
additionalIgnoreFiles:
  - .ignore
  - .example
values:
  key1: value1
  nested:
    enabled: true
    subkey: 123
```

### Спецификация запроса

| Название                | Опциональность   | Описание                                                                                                                      | Значение по умолчанию |
|-------------------------|------------------|-------------------------------------------------------------------------------------------------------------------------------|-----------------------|
| source_project_id       | **обязательно**  | Идентификатор проекта, который служит источником для Merge Request                                                            | -                     |
| target_project_id       | **обязательно**  | Идентификатор целевого проекта, в котором будет сформирован Merge Request                                                     | -                     |
| merge_request_spec      | **обязательно**  | Спецификация, соответствующая [GitLab Merge Requests API](https://docs.gitlab.com/ee/api/merge_requests.html#create-mr)       | -                     |
| source_project_tag      | опционально      | Тег в проекте-источнике, из которого будет сформирован Merge Request. Если не указан, используется ветка в проекте-источнике  | -                     |
| source_project_branch   | опционально      | Ветка в проекте-источнике, из которой будет сформирован Merge Request                                                         | main                  |
| additionalIgnoreFiles   | опционально      | Список файлов, содержащих пути для исключения из MR. Заполняется по аналогии с [.templateignore](#templateignore)             | -                     |
| values                  | опционально      | Переменные, используемые при шаблонизации, в формате `ключ: значение`                                                         | -                     |

### Учетные данные

* **password** — пароль (токен) пользователя, от имени которого будет запускаться выполнение действия.
* **username** — username пользователя, от имени которого будет запускаться выполнение действия.

### Алгоритм работы

Платформа:

1. Клонирует шаблонный репозиторий, который является шаблоном для генерации MR, согласно его ID (**source_project_id**). [Подробнее о шаблонизации](#детали-работы).
1. Считывает файл `values.yaml`, хранящийся в корне репозитория, и определяет переменные по умолчанию для шаблонизации.
1. Считывает переменные, передаваемые при запуске действия, и делает их merge с переменными из `values.yaml`. Приоритет при merge отдается переменным, передаваемым при запуске действия.
1. Считывает файл `.templateignore` и определяет директории и файлы, исключаемые из шаблонизации.
1. Рендерит из шаблонов файлы, учитывая `values.yaml` и переданные в действие переменные.
1. Изменяет remote репозитория на целевой, согласно его ID (**target_project_id**), и делает git push в целевую ветку (**source_project_branch**), либо в ветку **main**.
1. Создает MR, согласно заданным настройкам, путем отправки POST-запроса в GitLab API.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects/:id/merge_requests`.

## CreateGitlabProject

CreateGitlabProject — создает новый проект в GitLab. Действие осуществляет вызов GitLab API для создания проекта с указанными параметрами, такими как имя, путь проекта, описание и другие настройки. Для аутентификации используется GitLab token, который должен быть предоставлен в учетных данных.

### Пример запроса

```yaml
name: example
path: example
description: example
default_branch: main
initialize_with_readme: false
namespace_id: '0'
```

### Спецификация запроса

| Название               | Обязательность   | Описание                                                                                   | Значение по умолчанию |
|------------------------|------------------|--------------------------------------------------------------------------------------------|-----------------------|
| name                   | **обязательно**  | Название проекта, который будет создан в GitLab                                            | -                     |
| path                   | **обязательно**  | URL-совместимый путь проекта. Обычно совпадает с названием, но может отличаться            | -                     |
| default_branch         | **обязательно**  | Имя ветки, которая будет использоваться по умолчанию, например, "main"                     | -                     |
| namespace_id           | **обязательно**  | Идентификатор пространства имен (namespace) в GitLab, в котором будет создан проект        | -                     |
| initialize_with_readme | опционально      | Флаг, определяющий, нужно ли инициализировать проект с файлом README                       | false                 |
| description            | опционально      | Описание проекта, которое будет видно пользователям                                        | -                     |

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects`, передавая параметры запроса в формате JSON. В случае успешного создания проекта GitLab возвращает данные о вновь созданном проекте.

## CreateGitlabProjectVariables

CreateGitlabProjectVariables — создает переменные на уровне проекта в GitLab.

### Пример запроса

```yaml
project_id: '0'
variables:
  - key: EXAMPLE_VARIABLE
    value: value
```

### Спецификация запроса

| Название        | Обязательность  | Описание                                                                     |
|-----------------|-----------------|------------------------------------------------------------------------------|
| project_id      | **обязательно** | Идентификатор проекта, в котором необходимо создать переменные               |
| variables       | **обязательно** | Список создаваемых переменных                                                |

Список полей для variables соответствует официальному GitLab Project-level CI/CD variables API, `/projects/:id/variables`: [документация](https://docs.gitlab.com/api/project_level_variables/#create-a-variable)

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects/:id/variables`.

## CreateGitlabProjectWebhook

CreateGitlabProjectWebhook — создает webhook в проекте GitLab.

### Пример запроса

```yaml
project_id: '0'
url: https://example.com
push_events: true
issues_events: true
merge_requests_events: true
pipeline_events: true
```

### Спецификация запроса

| Название             | Обязательность  | Описание                                                                |
|----------------------|-----------------|-------------------------------------------------------------------------|
| project_id           | **обязательно** | Идентификатор проекта, в котором необходимо создать webhook             |
| url                  | **обязательно** | URL-адрес вебхука                                                       |
| push_events          | **обязательно** | Запускать вебхук при push в репозиторий                                 |
| issues_events        | **обязательно** | Запускать вебхук при создании issue                                     |
| merge_request_events | **обязательно** | Запускать вебхук при создании merge request                             |
| pipeline_events      | **обязательно** | Запускать вебхук при запуске pipeline                                   |

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects/:id/hooks`.

## CreateGitlabTag

CreateGitlabTag — создает новый тег в проекте GitLab.

### Пример запроса

```yaml
project_id: '0'
tag_name: v1.0.0
ref: main
message: Tag description
```

### Спецификация запроса

| Название             | Обязательность  | Описание                                                                      |
|----------------------|-----------------|-------------------------------------------------------------------------------|
| project_id           | **обязательно** | Идентификатор проекта, в котором необходимо создать тег                       |
| tag_name             | **обязательно** | Имя тега                                                                      |
| ref                  | **обязательно** | Название ветки, тег или SHA-хеш коммита, на который будет ссылаться новый тег |
| message              | опционально     | Описание тега                                                                 |

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects/:id/repository/tags`.

## CreateGitlabRelease

CreateGitlabRelease — создает релиз GitLab на основе уже существующего тега.

### Пример запроса

```yaml
project_id: '0'
tag_name: v1.0.0
name: Release v1.0.0
description: |
  ## Изменения
  - Новая функция
  - Исправления ошибок
```

### Спецификация запроса

| Название     | Обязательность  | Описание                                                                                   |
|--------------|-----------------|--------------------------------------------------------------------------------------------|
| project_id   | **обязательно** | Идентификатор проекта, в котором необходимо создать релиз                                  |
| tag_name     | **обязательно** | Имя существующего тега, на основе которого формируется релиз                               |
| name         | **обязательно** | Название релиза, отображаемое в GitLab                                                     |
| description  | опционально     | Описание релиза в формате Markdown                                                         |

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects/:id/releases`.

## CreateKafkaACLs

CreateKafkaACLs — создаёт новый набор ACL в Kafka.

### Пример запроса

```yaml
securityProtocol: SASL_PLAINTEXT
saslMechanism: PLAIN
acls:
  - topics:
      - example_1
    allow:
      - User:principal_2
      - Group:principal_3
    deny:
      - User:principal_4
      - Group:principal_5
    ops:
      - CREATE
      - READ
      - WRITE
      - DELETE
      - DESCRIBE
      - DESCRIBE_CONFIGS
      - ALTER
    pattern: LITERAL
  - topics:
      - example_6
    allow:
      - User:principal_7
    allow_hosts:
      - 127.0.0.1
    deny:
      - User:principal_8
    deny_hosts:
      - 127.0.0.1
    ops:
      - CREATE
    pattern: LITERAL
```

### Спецификация запроса

| Название                | Обязательность   | Описание                                                                                                                                                                                                   | Возможные значения                      | Значение по умолчанию  |
|-------------------------|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|------------------------|
| securityProtocol        | **обязательно**  | Протокол для подключения к Kafka. [Подробнее](https://kafka.apache.org/documentation/#adminclientconfigs_security.protocol)                                                                                | PLAINTEXT, SASL_PLAINTEXT, SASL_SSL     | -                      |
| saslMechanism           | опционально      | Механизм аутентификации, который будет использовать SASL. Обязателен при использовании протокола SASL_PLAINTEXT или SASL_SSL. [Подробнее](https://kafka.apache.org/documentation/#security_sasl_mechanism) | PLAIN, SCRAM-SHA-256, SCRAM-SHA-512     | -                      |
| acls                    | **обязательно**  | Набор ACL, которые необходимо создать                                                                                                                                                                      | -                                       | -                      |
| acls.ops                | **обязательно**  | Список операций, для которых будет создано правило.                                                                                                                                                        | См. список возможных операций           | -                      |
| acls.pattern            | **обязательно**  | Тип шаблона                                                                                                                                                                                                | См. список возможных pattern            | -                      |
| acls.topics             | опционально      | Список из названий топиков, для которых применять правило                                                                                                                                                  | -                                       | -                      |
| acls.groups             | опционально      | Список из названий групп, для которых применять правило                                                                                                                                                    | -                                       | -                      |
| acls.transactional_ids  | опционально      | Список из ID транзакций, для которых применять правило                                                                                                                                                     | -                                       | -                      |
| acls.tokens             | опционально      | Список токенов, для которых применять правило                                                                                                                                                              | -                                       | -                      |
| acls.allow              | опционально      | Список принципалов (user, group), для которых разрешить правило                                                                                                                                            | -                                       | -                      |
| acls.allow_hosts        | опционально      | Список хостов, для которых разрешить операцию                                                                                                                                                              | -                                       | -                      |
| acls.deny               | опционально      | Список принципалов (user, group), для которых запретить правило                                                                                                                                            | -                                       | -                      |
| acls.deny_hosts         | опционально      | Список хостов, для которых запретить операцию                                                                                                                                                              | -                                       | -                      |

### Учетные данные

* **user** — username пользователя, от имени которого будет запускаться выполнение действия.
* **password** — пароль пользователя, от имени которого будет запускаться выполнение действия.

### Список возможных паттернов

* ANY
* MATCH
* LITERAL
* PREFIXED

### Список возможных операций

[Документация Kafka](https://kafka.apache.org/39/documentation/#operations_resources_and_protocols)

**Topic:**

* ALL
* ALTER
* ALTER_CONFIGS
* CREATE
* DELETE
* DESCRIBE
* DESCRIBE_CONFIGS
* READ
* WRITE

**Group:**

* ALL
* DELETE
* DESCRIBE
* READ

**TransactionalID:**

* ALL
* DESCRIBE
* WRITE

**Tokens:**

* DESCRIBE

## CreateKafkaTopics

CreateKafkaTopics — создаёт новые топики в Kafka.

### Пример запроса

```yaml
securityProtocol: SASL_PLAINTEXT
saslMechanism: PLAIN
partitions: 1
replication_factor: 1
configs: {}
topics:
  - example_1
  - example_2
```

### Спецификация запроса

| Название                | Обязательность   | Описание                                                                                                                                                                                                   | Возможные значения                                                   |
|-------------------------|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
| securityProtocol       | **обязательно**  | Протокол для подключения к Kafka. [Подробнее](https://kafka.apache.org/documentation/#adminclientconfigs_security.protocol)                                                                                | PLAINTEXT, SASL_PLAINTEXT, SASL_SSL                                  |
| saslMechanism          | опционально      | Механизм аутентификации, который будет использовать SASL. Обязателен при использовании протокола SASL_PLAINTEXT или SASL_SSL. [Подробнее](https://kafka.apache.org/documentation/#security_sasl_mechanism) | PLAIN, SCRAM-SHA-256, SCRAM-SHA-512                                  |
| partitions              | **обязательно**  | Количество разделов (партиций), на которые будет разбит топик                                                                                                                                              | -                                                                    |
| replication_factor      | **обязательно**  | Количество копий (реплик) каждой партиции топика, которые необходимо разместить на разных брокерах                                                                                                         | -                                                                    |
| configs                 | **обязательно**  | Конфигурация в формате ключ значение для создаваемых топиков                                                                                                                                               | [Документация](https://kafka.apache.org/documentation/#topicconfigs) |
| topics                  | **обязательно**  | Список названий топиков, которые необходимо создать                                                                                                                                                        | -                                                                    |

### Учетные данные

* **user** — username пользователя, от имени которого будет запускаться выполнение действия.
* **password** — пароль пользователя, от имени которого будет запускаться выполнение действия.

## CreateKafkaUsers

CreateKafkaUsers — создаёт новых пользователей SASL/SCRAM в Kafka.

### Пример запроса

```yaml
securityProtocol: SASL_PLAINTEXT
saslMechanism: PLAIN
users:
  - user: example_user_1
    password: example_password_user_1
    mechanism: SCRAM-SHA-256
    iterations: 4096
  - user: example_user_2
    password: example_password_user_2
    mechanism: SCRAM-SHA-256
    iterations: 4096
```

### Спецификация запроса

| Название          | Обязательность   | Описание                                                                                                                                                                                                   | Возможные значения                      |
|-------------------|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
| securityProtocol | **обязательно**  | Протокол для подключения к Kafka. [Подробнее](https://kafka.apache.org/documentation/#adminclientconfigs_security.protocol)                                                                                | PLAINTEXT, SASL_PLAINTEXT, SASL_SSL     |
| saslMechanism    | опционально      | Механизм аутентификации, который будет использовать SASL. Обязателен при использовании протокола SASL_PLAINTEXT или SASL_SSL. [Подробнее](https://kafka.apache.org/documentation/#security_sasl_mechanism) | PLAIN, SCRAM-SHA-256, SCRAM-SHA-512     |
| users             | **обязательно**  | Набор пользователей, которых необходимо создать                                                                                                                                                            | -                                       |
| users.user        | **обязательно**  | Имя создаваемого пользователя                                                                                                                                                                              | -                                       |
| users.password    | **обязательно**  | Пароль создаваемого пользователя                                                                                                                                                                           | -                                       |
| users.mechanism   | **обязательно**  | Механизм аутентификации создаваемого пользователя                                                                                                                                                          | SCRAM-SHA-256, SCRAM-SHA-512            |
| users.iterations  | **обязательно**  | Количество итераций, которые будут применяться для хэширования пароля                                                                                                                                      | От 4096 до 16384                        |

### Учетные данные

* **user** — username пользователя, от имени которого будет запускаться выполнение действия.
* **password** — пароль пользователя, от имени которого будет запускаться выполнение действия.

## CreateCodeScoringProject

CreateCodeScoringProject — создает новый проект в системе CodeScoring. Действие использует CodeScoring API для регистрации проекта с указанными параметрами: название проекта, URL репозитория, ID VCS системы и опция автоматического запуска SCA-анализа после клонирования репозитория.

### Пример запроса

```yaml
name: example-project
repository: https://gitlab.example.com/group/project.git
vcs_id: 2
run_sca_after_clone: true
```

### Спецификация запроса

| Название           | Обязательность  | Описание                                                                 |
|--------------------|-----------------|--------------------------------------------------------------------------|
| name               | **обязательно** | Название проекта в CodeScoring                                           |
| repository         | **обязательно** | URL репозитория (например, <https://gitlab.example.com/group/project.git>) |
| vcs_id             | **обязательно** | ID VCS системы в CodeScoring (должен быть больше 0)                      |
| run_sca_after_clone| опционально     | Запускать ли SCA-анализ автоматически после клонирования репозитория     |

### Ответ

В ответе возвращается объект созданного проекта со следующей информацией: идентификатор проекта (pk), название, тип проекта, описание, информация о репозитории, статус проекта, права доступа, лицензия, количество зависимостей и уязвимостей, языки проекта, статус расписания сканирования и даты первого и последнего SCA-сканирования.

## DeleteCodeScoringProject

DeleteCodeScoringProject — удаляет проект в системе CodeScoring по его ID.

### Пример запроса

```yaml
id: 1
```

### Спецификация запроса

| Название | Обязательность  | Описание                    |
|----------|-----------------|-----------------------------|
| id       | **обязательно** | ID проекта в CodeScoring   |

## CreateKeycloakClient

CreateKeycloakClient — создает нового клиента в Keycloak.

### Пример запроса

```yaml
realm: master
config:
  clientId: example
  name: example
  enabled: true
  clientAuthenticatorType: client-secret
  secret: secret
  defaultClientScopes:
  - roles
  - profile
  - email
  optionalClientScopes:
  - address
  - phone
  - offline_access
```

### Спецификация запроса

| Название | Обязательность  | Описание                                                                                     | Возможные значения                                                                                |
|----------|-----------------|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| realm    | **обязательно** | Realm в Keycloak, где требуется создать клиента                                              | -                                                                                                 |
| config   | **обязательно** | Параметры создаваемого клиента в соответствии со спецификацией ClientRepresentation Keycloak | [Документация](https://www.keycloak.org/docs-api/latest/rest-api/index.html#ClientRepresentation) |

### Учетные данные

* **username** — username пользователя, от имени которого будет запускаться выполнение действия.
* **password** — пароль пользователя, от имени которого будет запускаться выполнение действия.

## CreateKubernetesResource

CreateKubernetesResource — создает новый ресурс или ресурсы в кластере Kubernetes или обновляет существующие.

### Пример запроса

```yaml
manifests:
  - apiVersion: v1
    kind: Namespace
    metadata:
      name: example1
  - apiVersion: v1
    kind: Namespace
    metadata:
      name: example2
```

### Спецификация запроса

| Название                   | Обязательность   | Описание                                                                                           |
|----------------------------|------------------|----------------------------------------------------------------------------------------------------|
| manifests                  | **обязательно**  | Манифесты Kubernetes, которые будут применены                                                      |

### Учетные данные

* **token** — токен сервисного аккаунта в Kubernetes.

## CreateRepositoryFromTemplate

CreateRepositoryFromTemplate — создает новый репозиторий из шаблона в Gitlab. Механизм рендеринга основан на [Go template](https://developer.hashicorp.com/nomad/tutorials/templates/go-template-syntax) и поддерживает все встроенные методы, а также расширения, добавленные в платформу.

### Пример запроса

```yaml
sourceBranch: main
sourceTag: v1.0.0
templateRepositoryUrl: https://gitlab.example.com/example-1.git
targetRepositoryUrl: https://gitlab.example.com/example-2.git
targetBranch: master
additionalIgnoreFiles:
  - .ignore
  - .example
values:
  key1: value1
  nested:
    enabled: true
    subkey: 123
```

### Спецификация запроса

| Название                 | Опциональность     | Описание                                                                                                                                | Значение по умолчанию |
|--------------------------|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
| templateRepositoryUrl    | **обязательно**    | URL шаблонного репозитория                                                                                                              | -                     |
| targetRepositoryUrl      | **обязательно**    | URL репозитория, который будет создан в результате выполнения действия                                                                  | -                     |
| values                   | **обязательно**    | Переменные, используемые при шаблонизации, в формате `ключ: значение`                                                                   | -                     |
| additionalIgnoreFiles    | опционально        | Список файлов, содержащих пути для для исключения из целевого репозитория. Заполняется по аналогии с [.templateignore](#templateignore) | -                     |
| sourceTag                | опционально        | Тег шаблонного репозитория, который будет использоваться при шаблонизации. Если не указан, используется ветка шаблонного репозитория    | -                     |
| sourceBranch             | опционально        | Ветка шаблонного репозитория, которая будет использоваться при шаблонизации                                                             | main                  |
| targetBranch             | опционально        | Ветка целевого репозитория, которая будет создана в результате выполнения действия                                                      | main                  |

### Учетные данные

* **password** — пароль (токен) пользователя, от имени которого будет запускаться выполнение действия.
* **username** — username пользователя, от имени которого будет запускаться выполнение действия.

### Алгоритм работы

Платформа:

1. Клонирует шаблонный репозиторий по указанному URL (**templateRepositoryUrl**), используя в качестве ref либо **sourceTag**, либо **sourceBranch**, либо ветку **main**.
1. Считывает файл `values.yaml` хранящийся в корне репозитория и определяет переменные по умолчанию для шаблонизации.
1. Считывает переменные, передаваемые при запуске действия, и делает их merge с переменными из `values.yaml`. Приоритет при merge отдается переменным, передаваемым при запуске действия.
1. Считывает файл `.templateignore` и определяет директории и файлы, исключаемые из шаблонизации.
1. Рендерит из шаблонов файлы, учитывая `values.yaml` и переданные в действие переменные.
1. Изменяет remote репозитория на целевой (**targetRepositoryUrl**) и делает git push в целевую ветку. (**targetBranch**), либо в ветку **main**.

### Детали работы

Действие поддерживает шаблонизацию названий директорий и файлов, для этого необходимо в их название добавить выражение в формате [Go template](https://developer.hashicorp.com/nomad/tutorials/templates/go-template-syntax), например директория `src/{{ .module }}/utils` при наличии value **module** со значением **example** будет отрендерена в директорию `src/example/utils` в целевом репозитории.

Если после рендеринга из шаблона содержимое файла будет отсутствовать, то он не будет создан. Например файл с содержимым:

```go
{{- if .createContent }}
- Это контент, который будет отображаться, если переменная createContent == true
{{- end }}
```

не будет создан, если переменная **createContent** имеет значение **false**. Аналогичным образом, не будут созданы файлы, изначально являющиеся пустыми.

При отсутствии переменных для шаблонизации одновременно в файле `values.yaml` и в переменных, передаваемых при запуске действия, рендеринг завершится с ошибкой и целевой репозиторий создан не будет.

### Переменные шаблонного репозитория

Для добавления переменных по умолчанию, используемых при шаблонизации, необходимо создать в корне репозитория файд values.yaml с соответствующим содержимым.

Пример файла `values.yaml`:

```yaml
module: example
createContent: false
```

Файл `values.yaml` является опциональным.

<a id="templateignore"></a>

### Исключение файлов

Некоторые файлы могут содержать переменные в формате [Go template](https://developer.hashicorp.com/nomad/tutorials/templates/go-template-syntax), которые необходимо сохранять при рендеринге репозитория из шаблона, например, Helm чарты в директории `helm`. Директория `.git` игнорируется всегда.

Для исключения подобных файлов из механизма рендеринга следует добавить в корень репозитория файл `.templateignore` с соответствующим содержимым.

Пример файла `.templateignore` для игнорирования содержимого директорий `helm`, `docs`:

```sh
helm/**
docs/**
```

Файл `.templateignore` является опциональным.

### Пример структуры директорий шаблонного репозитория

```sh
├── example-folder-01
│   ├── example-file-01
│   └── {{ .example }}-file-02
├── {{ .example }}-folder-02
│   └── ...
├── values.yaml
└── .templateignore
```

Если переменная **example** при рендере репозитория примет значение **new**, то итоговая структура после рендера будет выглядеть следующим образом:

```sh
├── example-folder-01
│   ├── example-file-01
│   └── new-file-02
├── new-folder-02
│   └── ...
├── values.yaml
└── .templateignore
```

### Локальная отладка

Для локальной отладки шаблонов подготовлена утилита **ddp-render-dir**.

Утилита:

1. Создает копию исходной директории.
2. Рендерит файлы в созданной директории аналогично тому, как это делает действие по созданию репозиториев из шаблонов.

Ключи командной строки для запуска:

* **--source-dir** — исходная директория, которую необходимо отрендерить.
* **--target-dir** — директория, в которую будет помещен результат рендеринга.
* **--values** (опционально) —  путь к файлу `values.yaml` с переменными, которые будут использоваться при рендеринге.
* **--ignore-files** (опционально) — список файлов, содержащих пути для для исключения из целевого репозитория.

## CreateSonarqubeProject

CreateSonarqubeProject — создает новый проект в SonarQube. Действие использует SonarQube Web API для создания проекта с указанными параметрами, такими как ключ (project key), имя проекта, главная ветка, параметры определения нового кода (new code definition) и видимость проекта. Аутентификация осуществляется с использованием SonarQube token, который должен быть передан в учетных данных.

### Пример запроса

```yaml
project: example-project
name: example-project
mainBranch: develop
newCodeDefinitionType: NUMBER_OF_DAYS
newCodeDefinitionValue: '30'
visibility: public
```

### Спецификация запроса

| Название                | Обязательность   | Описание                                                                                        | Возможные значения                                 | Значение по умолчанию |
|-------------------------|------------------|-------------------------------------------------------------------------------------------------|----------------------------------------------------|------------------------|
| project                 | **обязательно**  | Уникальный идентификатор проекта (Project Key) в SonarQube                                      | -                                                  | -                      |
| name                    | **обязательно**  | Название проекта, отображаемое в интерфейсе SonarQube                                           | -                                                  | -                      |
| mainBranch              | опционально      | Название главной ветки проекта                                                                  | -                                                  | master                 |
| newCodeDefinitionType   | опционально      | Метод определения «нового кода»                                                                 | PREVIOUS_VERSION, NUMBER_OF_DAYS, REFERENCE_BRANCH | -                      |
| newCodeDefinitionValue  | опционально      | Значение для определения "нового кода" (например, количество дней, если тип - NUMBER_OF_DAYS)   | -                                                  | -                      |
| visibility              | опционально      | Видимость проекта                                                                               | private, public                                    | private                |

### Учетные данные

* **token** — токен Sonarqube с типом User Token, сгенерированный пользователем, от имени которого будет запускаться выполнение действия.

## CreateVaultSecret

CreateVaultSecret — создает секрет с одним или несколькими значениями в HashiCorp Vault.

### Пример запроса

```yaml
path: example/data/path
secrets:
  - key: key1
    value: value1
  - key: key2
    value: value2
```

### Спецификация запроса

| Название                  | Обязательность   | Описание                                                                                           | По умолчанию |
|---------------------------|------------------|----------------------------------------------------------------------------------------------------|--------------|
| path                      | **обязательно**  | Путь, по которому будет сохранён секрет в Vault                                                    | -            |
| allow_update              | опционально      | Разрешить создание новой версии секрета, если секрет уже существует в Vault                        | false        |
| secrets                   | **обязательно**  | Набор секретов, которые необходимо создать в Vault                                                 | -            |
| secrets.key               | **обязательно**  | Имя (идентификатор) секрета                                                                        | -            |
| secrets.value             | **обязательно**  | Значение секрета                                                                                   | -            |

### Учетные данные

* **token** — Vault-токен, который имеет необходимые права для создания секретов.

## DeleteVaultSecret

DeleteVaultSecret — удаляет секрет из HashiCorp Vault.

### Пример запроса

```yaml
path: example/data/path
```

### Спецификация запроса

| Название                  | Обязательность   | Описание                                                                                           |
|---------------------------|------------------|----------------------------------------------------------------------------------------------------|
| path                      | **обязательно**  | Путь, по которому находится секрет в Vault, который необходимо удалить                             |

### Учетные данные

* **token** — Vault-токен, который имеет необходимые права для удаления секретов.

## DeleteDefectdojoProduct

DeleteDefectdojoProduct — удаляет продукт из DefectDojo. Действие использует DefectDojo API v2.

### Пример запроса

```yaml
id: 1
```

### Спецификация запроса

| Название    | Обязательность   | Описание                                           | Значение по умолчанию  |
|-------------|------------------|----------------------------------------------------|------------------------|
| id          | **обязательно**  | Идентификатор продукта, который необходимо удалить | -                      |

### Учетные данные

* **token** — API v2 Key пользователя, от имени которого будет запускаться выполнение действия.

## DeleteGitlabProject

DeleteGitlabProject - удаляет существующий проект в GitLab. Действие осуществляет вызов GitLab API для удаление проекта. Для аутентификации используется GitLab token, который должен быть предоставлен в креденшилах.

### Пример запроса

```yaml
project_id: 0
```

### Спецификация запроса

| Название                  | Обязательность   | Описание                                                                                           |
|---------------------------|------------------|----------------------------------------------------------------------------------------------------|
| project_id                | **обязательно**  | Идентификатор проекта, который необходимо удалить                                                  |

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет DELETE-запрос по URL: `/api/v4/projects/:id`.

## DeleteKafkaACLs

DeleteKafkaACLs — удаляет набор ACL в Kafka.

### Пример запроса

```yaml
securityProtocol: SASL_PLAINTEXT
saslMechanism: PLAIN
acls:
  - topics:
      - example_1
    allow:
      - User:principal_2
      - Group:principal_3
    allow_hosts:
      - 127.0.0.1
    deny:
      - User:principal_4
      - Group:principal_5
    deny_host:
      - 127.0.0.1
    ops:
      - CREATE
      - READ
      - WRITE
      - DELETE
      - DESCRIBE
      - DESCRIBE_CONFIGS
      - ALTER
    pattern: LITERAL
  - any_topic: true
    any_group: true
    any_transactional_id: true
    any_allow: true
    any_allow_hosts: true
    any_deny: true
    any_deny_hosts: true
    ops:
      - ANY
    pattern: ANY
  - any_resource: true
    any_allow: true
    any_allow_hosts: true
    any_deny: true
    any_deny_hosts: true
    ops:
      - ANY
    pattern: ANY
```

### Спецификация запроса

| Название                  | Обязательность   | Описание                                                                                                                                                                                                   | Возможные значения                      | Значение по умолчанию  |
|---------------------------|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|------------------------|
| securityProtocol          | **обязательно**  | Протокол для подключения к Kafka. [Подробнее](https://kafka.apache.org/documentation/#adminclientconfigs_security.protocol)                                                                                | PLAINTEXT, SASL_PLAINTEXT, SASL_SSL     | -                      |
| saslMechanism             | опционально      | Механизм аутентификации, который будет использовать SASL. Обязателен при использовании протокола SASL_PLAINTEXT или SASL_SSL. [Подробнее](https://kafka.apache.org/documentation/#security_sasl_mechanism) | PLAIN, SCRAM-SHA-256, SCRAM-SHA-512     | -                      |
| acls                      | **обязательно**  | Набор ACL, которые необходимо создать                                                                                                                                                                      | -                                       | -                      |
| acls.ops                  | **обязательно**  | Список операций, для которых будет создано правило.                                                                                                                                                        | См. список возможных операций           | -                      |
| acls.pattern              | **обязательно**  | Тип шаблона                                                                                                                                                                                                | См. список возможных pattern            | -                      |
| acls.any_resource         | опционально      | Все ресурсы                                                                                                                                                                                                | -                                       | false                  |
| acls.topics               | опционально      | Список из названий топиков, для которых применять правило                                                                                                                                                  | -                                       | -                      |
| acls.any_topic            | опционально      | Все топики                                                                                                                                                                                                 | -                                       | false                  |
| acls.groups               | опционально      | Список из названий групп, для которых применять правило                                                                                                                                                    | -                                       | -                      |
| acls.any_group            | опционально      | Все топики                                                                                                                                                                                                 | -                                       | false                  |
| acls.transactional_ids    | опционально      | Список из ID транзакций, для которых применять правило                                                                                                                                                     | -                                       | -                      |
| acls.any_transactional_id | опционально      | Любая транзакция                                                                                                                                                                                           | -                                       | false                  |
| acls.tokens               | опционально      | Список токенов, для которых применять правило                                                                                                                                                              | -                                       | -                      |
| acls.any_token            | опционально      | Все токены                                                                                                                                                                                                 | -                                       | false                  |
| acls.allow                | опционально      | Список принципалов (user, group), для которых разрешить правило                                                                                                                                            | -                                       | -                      |
| acls.any_allow            | опционально      | Любой принципал (user, group)                                                                                                                                                                              | -                                       | false                  |
| acls.allow_hosts          | опционально      | Список хостов, для которых разрешить операцию                                                                                                                                                              | -                                       | -                      |
| acls.any_allow_hosts      | опционально      | Любой хост, с которого разрешено проводить операцию                                                                                                                                                        | -                                       | false                  |
| acls.deny                 | опционально      | Список принципалов (user, group), для которых запретить правило                                                                                                                                            | -                                       | -                      |
| acls.any_deny             | опционально      | Любой принципал (user, group)                                                                                                                                                                              | -                                       | false                  |
| acls.deny_hosts           | опционально      | Список хостов, для которых запретить операцию                                                                                                                                                              | -                                       | -                      |
| acls.any_deny_hosts       | опционально      | Любой хост, с которого запрещено проводить операцию                                                                                                                                                        | -                                       | false                  |

### Учетные данные

* **user** — username пользователя, от имени которого будет запускаться выполнение действия.
* **password** — пароль пользователя, от имени которого будет запускаться выполнение действия.

### Список возможных pattern

* ANY
* MATCH
* LITERAL
* PREFIXED

### Список возможных операций

[Документация Kafka](https://kafka.apache.org/39/documentation/#operations_resources_and_protocols)

**Topic:**

* ALL
* ALTER
* ALTER_CONFIGS
* CREATE
* DELETE
* DESCRIBE
* DESCRIBE_CONFIGS
* READ
* WRITE

**Group:**

* ALL
* DELETE
* DESCRIBE
* READ

**TransactionalID:**

* ALL
* DESCRIBE
* WRITE

**Token:**

* DESCRIBE

## DeleteKafkaTopics

DeleteKafkaTopics — удаляет существующие топики в Kafka.

### Пример запроса

```yaml
securityProtocol: SASL_PLAINTEXT
saslMechanism: PLAIN
topics:
  - example_1
  - example_2
```

### Спецификация запроса

| Название                  | Обязательность   | Описание                                            | Возможные значения                      |
|---------------------------|------------------|-----------------------------------------------------|-----------------------------------------|
| auth_type                 | **обязательно**  | Тип авторизации в Kafka                             | PLAINTEXT, SCRAM-SHA-256, SCRAM-SHA-512 |
| topics                    | **обязательно**  | Список названий топиков, которые необходимо удалить | -                                       |

### Учетные данные

* **user** — username пользователя, от имени которого будет запускаться выполнение действия.
* **password** — пароль пользователя, от имени которого будет запускаться выполнение действия.

## DeleteKafkaUsers

DeleteKafkaUsers — удаляет существующих пользователей SASL/SCRAM в Kafka.

### Пример запроса

```yaml
securityProtocol: SASL_PLAINTEXT
saslMechanism: PLAIN
users:
  - user: example_user_1
    mechanism: SCRAM-SHA-256
  - user: example_user_2
    mechanism: SCRAM-SHA-256
```

### Спецификация запроса

| Название          | Обязательность   | Описание                                                                                                                                                                                                   | Возможные значения                      |
|-------------------|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
| securityProtocol | **обязательно**  | Протокол для подключения к Kafka. [Подробнее](https://kafka.apache.org/documentation/#adminclientconfigs_security.protocol)                                                                                | PLAINTEXT, SASL_PLAINTEXT, SASL_SSL     |
| saslMechanism    | опционально      | Механизм аутентификации, который будет использовать SASL. Обязателен при использовании протокола SASL_PLAINTEXT или SASL_SSL. [Подробнее](https://kafka.apache.org/documentation/#security_sasl_mechanism) | PLAIN, SCRAM-SHA-256, SCRAM-SHA-512     |
| users             | **обязательно**  | Набор пользователей, которых необходимо удалить                                                                                                                                                            | -                                       |
| users.user        | **обязательно**  | Имя удаляемого пользователя                                                                                                                                                                                | -                                       |
| users.mechanism   | **обязательно**  | Механизм аутентификации удаляемого пользователя                                                                                                                                                            | SCRAM-SHA-256, SCRAM-SHA-512            |

### Учетные данные

* **user** — username пользователя, от имени которого будет запускаться выполнение действия.
* **password** — пароль пользователя, от имени которого будет запускаться выполнение действия.

## DeleteKubernetesResource

DeleteKubernetesResource — удаляет существующий ресурс в кластере Kubernetes.

### Пример запроса

```yaml
group: apps
version: v1
resource_type: deployments
resource_name: nginx-deployment
namespace: example
```

### Спецификация запроса

| Название                  | Обязательность   | Описание                                                                     | Возможные значения                                                   |
|---------------------------|------------------|------------------------------------------------------------------------------|----------------------------------------------------------------------|
| group                     | **обязательно**  | API-группа ресурса. Указывает, к какой группе API относится удаляемый объект | См. определение требуемых Group и Version |
| version                   | **обязательно**  | Версия API ресурса                                                           | См. определение требуемых Group и Version |
| resource_type             | **обязательно**  | Тип удаляемого ресурса                                                       | pods, services, deployments, statefulsets, daemonsets, replicasets, jobs, cronjobs, nodes, namespaces, configmaps, secrets, persistentvolumes, persistentvolumeclaims, limitranges, resourcequotas, horizontalpodautoscalers, ingresses, networkpolicies, serviceaccounts, roles, clusterroles, rolebindings, clusterrolebindings, podsecuritypolicies, storageclasses, volumeattachments, events, endpoints, customresourcedefinitions |
| resource_name             | **обязательно**  | Имя конкретного ресурса, который необходимо удалить                          | -                                                                    |
| namespace                 | **обязательно**  | Namespace, в котором находится ресурс                                        | -                                                                    |

### Учетные данные

* **token** — токен сервисного аккаунта в Kubernetes.

### Определение требуемых Group и Version

Каждому типу ресурса соответствует своя версия и группа. Полный список API-ресурсов с их группами и версиями: [документация Kubernetes](https://kubernetes.io/docs/reference/kubernetes-api/)

Если неизвестно, какие требуются Group и Version, можно попробовать подставить актуальные значения. Есть несколько вариантов как их посмотреть:

#### С помощью утилиты kubectl

Команда `kubectl explain` показывает `apiVersion` для ресурса.

Пример:

```bash
kubectl explain deployment
```

Вывод:

```yaml
GROUP:      apps
KIND:       Deployment
VERSION:    v1

DESCRIPTION:
    Deployment enables declarative updates for Pods and ReplicaSets.
    
FIELDS:
...
```

#### С помощью документации

Как искать в документации:

1. Найдите нужный ресурс (например, Deployment).
1. В заголовке будет указана API Group и версия. Пример для Deployment:

   ```yaml
   apiVersion: apps/v1
   ```

* **API Group** - apps
* **Version** - v1

## DeleteSonarqubeProject

DeleteSonarqubeProject — удаляет проект из SonarQube.

### Пример запроса

```yaml
project: example-project
```

### Спецификация запроса

| Название         | Обязательность   | Описание                                                        | Значение по умолчанию  |
|------------------|------------------|-----------------------------------------------------------------|------------------------|
| project          | **обязательно**  | Идентификатор (Project Key) проекта, который необходимо удалить | -                      |

### Учетные данные

* **token** — токен Sonarqube с типом User Token, сгенерированный пользователем, от имени которого будет запускаться выполнение действия.

## DeleteSonarqubeProjects

DeleteSonarqubeProjects — удаляет один или несколько проектов из SonarQube.

### Пример запроса

```yaml
analyzedBefore: 2017-10-19T13:00:00+0200
onProvisionedOnly: 'false'
projects: example_project,another_project
q: example
qualifiers: TRK
```

### Спецификация запроса

| Название           | Обязательность   | Описание                                                                        | Возможные значения            | Примеры значений                      |
|--------------------|------------------|---------------------------------------------------------------------------------|-------------------------------|---------------------------------------|
| analyzedBefore     | опционально      | Удалить все проекты, в которых последний анализ старше определённой даты        | -                             | 2017-10-19, 2017-10-19T13:00:00+0200  |
| onProvisionedOnly  | опционально      | Фильтровать проекты по значению `onProvisionedOnly`                             | true, false, yes, no          | -                                     |
| projects           | опционально      | Список ключей проектов, который необходимо удалить                              | -                             | my_project, another_project           |
| q                  | опционально      | Удалить все проекты, в названии или ключе которых содержится заданная подстрока | -                             | example                               |
| qualifiers         | опционально      | Фильтровать проекты по указанным квалификаторам                                 | TRK, VW, APP                  |                                       |

### Учетные данные

* **token** — токен Sonarqube с типом User Token, сгенерированный пользователем, от имени которого будет запускаться выполнение действия.

## StartGitlabPipeline

StartGitlabPipeline — запускает выполнение пайплайна в GitLab.

### Пример запроса

```yaml
project_id: 0
ref: main
variables:
  - key: example-key
    value: example-value
```

### Спецификация запроса

| Название                  | Обязательность   | Описание                                                                     |
|---------------------------|------------------|------------------------------------------------------------------------------|
| project_id                | **обязательно**  | Идентификатор проекта, в котором необходимо запустить пайплайн               |
| ref                       | **обязательно**  | Название ветки, тег или SHA-хеш коммита, на котором будет запущен пайплайн   |
| variables                 | опционально      | Список переменных, которые необходимо передать в запускаемый пайплайн        |
| variables.key             | **обязательно**  | Название переменной                                                          |
| variables.value           | **обязательно**  | Значение переменной           |

### Учетные данные

* **token** — токен пользователя, от имени которого будет запускаться выполнение действия.

### Примечание

Для выполнения действия необходимо наличие корректных реквизитов с GitLab token. Этот токен передается через механизм учетных данных и используется для аутентификации при вызове GitLab API (HTTP-заголовок `Private-Token`).

Действие осуществляет POST-запрос по URL: `/api/v4/projects/:id/pipeline`.

## CreateVaultKubernetesAuthRole

CreateVaultKubernetesAuthRole — создаёт или обновляет роль аутентификации Kubernetes в HashiCorp Vault.

### Пример запроса

```yaml
mountPath: kubernetes
role: example
bound_service_account_names:
  - default
bound_service_account_namespaces:
  - default
optional:
  token_ttl: 1h
  token_max_ttl: 12h
  audience: vault
  token_policies:
    - default
```

### Спецификация запроса

| Название                            | Обязательность | Описание                                                                          |
|-------------------------------------|----------------|-----------------------------------------------------------------------------------|
| mountPath                           | обязательно    | Путь монтирования Kubernetes auth backend в Vault (например, kubernetes)          |
| role                                | обязательно    | Название роли, которая создаётся в Vault                                          |
| bound_service_account_names         | обязательно    | Список имён service account'ов, которым разрешён доступ через данную роль         |
| bound_service_account_namespaces    | обязательно    | Список пространств имён (namespaces), в которых разрешён доступ через данную роль |
| optional                            | необязательно  | Дополнительные параметры роли (см. ниже)                                          |

Поддерживаемые значения в optional:

| Поле                    | Тип           | Описание                                                               |
|-------------------------|---------------|------------------------------------------------------------------------|
| token_ttl               | string        | Время жизни (TTL) токена, выданного при логине                         |
| token_max_ttl           | string        | Максимальное TTL токена                                                |
| token_policies          | []string      | Дополнительные политики, назначаемые при логине                        |
| audience                | string        | JWT audience (aud), который Vault ожидает от токена                    |
| token_period            | string        | Если задано, выдаёт периодический токен                                |
| token_explicit_max_ttl  | string        | Устанавливает явный верхний предел TTL токена                          |
| token_num_uses          | int           | Ограничение на количество использований токена                         |
| token_type              | string        | Тип выдаваемого токена (например, service, batch)                      |
| alias_name_source       | string        | Источник alias name для identity                                       |
| token_no_default_policy | bool          | Не включать default policy в выданный токен                            |
| token_bound_cidrs       | []string      | Ограничение CIDR-диапазонов, откуда можно использовать выданный токен  |

Полный список поддерживаемых параметров см. в [официальной документации](https://developer.hashicorp.com/vault/docs/auth/kubernetes#parameters) HashiCorp Vault.

### Учетные данные

* **token** — Vault-токен, обладающий правами на создание/обновление ролей Kubernetes auth backend.

## CreateNexusRepository

**CreateNexusRepository** — создаёт новый репозиторий любого поддерживаемого типа (maven, docker, npm и др.) в Nexus Repository Manager 3 с помощью REST API.  
Параметры формата, типа и другие ключевые настройки полностью настраиваются и соответствуют Nexus API.

### Пример запроса (Maven hosted)

```yaml
description: |
  Maven hosted repo for internal Java build artifacts.
name: my-maven-repo
format: maven
type: hosted
online: true
storage:
  blobStoreName: default
  strictContentTypeValidation: true
  writePolicy: ALLOW
cleanup:
  policyNames:
    - maven-cleanup
maven:
  versionPolicy: RELEASE
  layoutPolicy: PERMISSIVE
```

### Пример запроса (Docker group)

```yaml
description: |
  Docker group repo aggregating hosted+proxy.
name: my-docker-group
format: docker
type: group
online: true
storage:
  blobStoreName: default
  strictContentTypeValidation: true
group:
  memberNames:
    - docker-hosted
    - docker-proxy
docker:
  v1Enabled: false
  forceBasicAuth: true
  httpPort: 5001
```

### Спецификация запроса

| Поле        | Обязательность  | Описание                                                                                             | Пример                   |
|-------------|-----------------|------------------------------------------------------------------------------------------------------|--------------------------|
| `description` | опционально    | Документация по назначению этого действия/репозитория. Не используется самим Nexus, только для UI    | ...                      |
| `name`      | **обязательно** | Имя создаваемого репозитория. Должно быть уникальным в рамках Nexus                                 | my-maven-repo            |
| `format`    | **обязательно** | Формат (`maven`, `docker`, `npm`, `raw`, ...)                                                        | maven                    |
| `type`      | **обязательно** | Тип: `hosted`, `proxy` или `group`                                                                   | hosted                   |
| `online`    | **обязательно** | Доступен ли репозиторий (`true`/`false`)                                                             | true                     |
| `storage`   | **обязательно** | Объект storage: `blobStoreName`, `strictContentTypeValidation`, `writePolicy`                        | см. пример выше          |
| `cleanup`   | опционально     | Привязанные политики очистки (`policyNames`)                                                          | policyNames: [maven-cleanup] |
| `maven`     | для maven       | Только для maven: `versionPolicy`, `layoutPolicy`                                                    | см. пример выше          |
| `proxy`     | для proxy       | Прокси-репозиторий: `remoteUrl`, `contentMaxAge`, `metadataMaxAge`                                   | ...                      |
| `group`     | для group       | Список включенных memberNames                                                                        | memberNames: [...]       |
| `docker`    | для docker      | docker-specific: `httpPort`, `v1Enabled`, `forceBasicAuth`                                           | см. пример выше          |
| `component` | очень редко     | Только для некоторых нестандартных сценариев                                                         | ...                      |
| `attributes`| опционально     | Любые кастомные поля                                                                                  | ...                      |

### Требования

- Используйте **только те блоки** (`maven`, `group`, `proxy`, `docker` и пр.), которые поддерживаются для вашего типа/формата.
- Для maven hosted обязательно `maven: {versionPolicy, layoutPolicy}`.
- Для group — обязательно `group.memberNames`.
- Для proxy — обязательно `proxy.remoteUrl`.
- Для docker — специфичные поля в `docker`.

### Учетные данные

* **token** — строка base64(`admin:password`), используется как Basic Auth при запросах к Nexus.

### Документация API

- [Nexus 3 REST API: Repository Management](https://help.sonatype.com/en/repositories-api.html)

## DeleteNexusRepository

**DeleteNexusRepository** — удаляет существующий репозиторий из Nexus Repository Manager 3.

### Пример запроса

```yaml
name: my-repo-to-delete
```

### Спецификация запроса

| Поле | Обязательность  | Описание                                 |
|------|-----------------|------------------------------------------|
| `name` | **обязательно** | Имя репозитория, который требуется удалить |

### Алгоритм

- Выполняется `DELETE` по адресу `/service/rest/v1/repositories/{name}`, где `{name}` — это значение поля `name`.
- Если репозиторий найден и удалён — возвращается 204.
- Если не найден — ошибка 404.

### Учетные данные

* **token** — строка base64(`admin:password`), используется как Basic Auth при запросах к Nexus.

### Документация API

- [Nexus 3 REST API: Repository Management](https://help.sonatype.com/en/repositories-api.html)
